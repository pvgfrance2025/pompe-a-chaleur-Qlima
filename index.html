<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Simulateur pompe à chaleur air-air</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <div class="page-wrapper">
      <!-- Logo -->
      <header class="logo-wrapper">
        <img src="Logo_Qlima_White (2).png" alt="Logo Qlima" class="logo" />
      </header>

      <main class="main-content">
        <section class="card">
          <button id="back-btn" class="back-btn" style="display: none">
            ←
          </button>

          <h1 class="card-title">Simulateur de pompe à chaleur air-air</h1>
          <p class="card-subtitle">
            Répondez à quelques questions pour obtenir un modèle adapté.
          </p>

          <div id="question-container">
            <h2 id="question-text" class="question-text"></h2>
            <div id="options-container" class="options-container"></div>
          </div>

          <p id="step-indicator" class="step-indicator"></p>
        </section>
      </main>
    </div>

    <script>
      const steps = [
        {
          key: "housing",
          label: "Quel type de logement souhaitez-vous équiper ?",
          options: [
            { label: "Maison individuelle", value: "maison" },
            { label: "Appartement", value: "appartement" },
          ],
        },
        {
          key: "status",
          label: "Êtes-vous propriétaire ou locataire du logement ?",
          options: [
            { label: "Propriétaire", value: "proprietaire" },
            {
              label: "Locataire avec accord du propriétaire / bailleur",
              value: "locataire_accord",
            },
            {
              label: "Locataire sans accord (ou en attente d’accord)",
              value: "locataire_sans_accord",
            },
          ],
        },
        {
          key: "copro",
          label:
            "Êtes-vous en copropriété et les unités extérieures sont-elles autorisées ?",
          options: [
            {
              label: "Pas en copropriété / maison individuelle",
              value: "pas_copro",
            },
            {
              label: "Oui, autorisées (ou accord du syndic)",
              value: "autorise",
            },
            {
              label: "Je ne sais pas / à vérifier",
              value: "a_verifier",
            },
            {
              label: "Non, interdit en façade / balcon",
              value: "interdit",
            },
          ],
        },
        {
          key: "outdoorSpace",
          label:
            "Disposez-vous d’un emplacement possible pour l’unité extérieure ?",
          options: [
            { label: "Au sol (jardin, terrasse)", value: "sol" },
            { label: "En façade / mur extérieur", value: "mur" },
            { label: "Balcon / loggia", value: "balcon" },
            {
              label: "Je ne dispose d’aucun emplacement adapté",
              value: "aucun",
            },
          ],
        },
        {
          key: "usage",
          label:
            "Pour quel usage principal souhaitez-vous la pompe à chaleur ?",
          options: [
            {
              label: "Chauffage principal de la pièce",
              value: "chauffage_principal",
            },
            { label: "Chauffage d’appoint / confort", value: "appoint" },
            {
              label: "Climatisation principalement (rafraîchissement)",
              value: "clim",
            },
          ],
        },
        {
          key: "surface",
          label: "Quelle est la surface de la pièce principale à équiper ?",
          options: [
            { label: "Moins de 25 m²", value: "S1" },
            { label: "25 à 35 m²", value: "S2" },
            { label: "Plus de 35 m²", value: "S3" },
          ],
        },
        {
          key: "height",
          label: "Quelle est la hauteur sous plafond de la pièce ?",
          options: [
            { label: "Hauteur standard (≈ 2,4 à 2,5 m)", value: "standard" },
            { label: "Entre 2,6 et 3 m", value: "haute" },
            { label: "Plus de 3 m / mezzanine", value: "tres_haute" },
          ],
        },
        {
          key: "openSpace",
          label:
            "La pièce est-elle ouverte sur d’autres espaces (cuisine, couloir, salon) ?",
          options: [
            { label: "Pièce fermée", value: "fermee" },
            { label: "Semi-ouverte", value: "semi_ouverte" },
            { label: "Très ouverte / grande pièce de vie", value: "ouverte" },
          ],
        },
        {
          key: "isolation",
          label: "Comment est l’isolation de votre logement ?",
          options: [
            { label: "Très bonne (récente, RT 2012 ou mieux)", value: "bonne" },
            {
              label: "Correcte (double vitrage, isolation standard)",
              value: "moyenne",
            },
            { label: "Faible (ancien logement, peu isolé)", value: "faible" },
          ],
        },
        {
          key: "windows",
          label: "Quelle est l’exposition principale de la pièce (fenêtres) ?",
          options: [
            { label: "Nord / peu de soleil", value: "nord" },
            { label: "Est / soleil le matin", value: "est" },
            { label: "Sud / très ensoleillé", value: "sud" },
            { label: "Ouest / soleil l’après-midi", value: "ouest" },
          ],
        },
        {
          key: "climate",
          label: "Dans quelle région habitez-vous ?",
          options: [
            { label: "Nord / Est de la France", value: "froid" },
            { label: "Centre / Ouest", value: "temperer" },
            { label: "Sud / Méditerranée", value: "doux" },
            { label: "Zone de montagne (> 800 m)", value: "montagne" },
          ],
        },
        {
          key: "rooms",
          label: "Combien de pièces souhaitez-vous équiper au total ?",
          options: [
            { label: "1 pièce", value: 1 },
            { label: "2 pièces", value: 2 },
            { label: "3 pièces ou plus", value: 3 },
          ],
        },
        {
          key: "electricPower",
          label:
            "Quelle est la puissance de votre abonnement électrique (si vous la connaissez) ?",
          options: [
            { label: "6 kVA ou moins", value: "6kva" },
            { label: "9 kVA ou plus", value: "9kva" },
            { label: "Je ne sais pas", value: "inconnu" },
          ],
        },
        {
          key: "electricPanel",
          label:
            "Votre tableau électrique est-il récent avec de la place pour un circuit dédié ?",
          options: [
            { label: "Oui", value: "oui" },
            { label: "Non / très ancien", value: "non" },
            { label: "Je ne sais pas", value: "inconnu" },
          ],
        },
        {
          key: "noise",
          label:
            "Avez-vous des contraintes fortes de bruit (voisins proches, chambres mitoyennes, etc.) ?",
          options: [
            { label: "Oui, contraintes importantes", value: "fortes" },
            { label: "Non, contraintes limitées", value: "faibles" },
          ],
        },
      ];

      const answers = {};
      let currentStep = 0;

      const questionTextEl = document.getElementById("question-text");
      const optionsContainerEl = document.getElementById("options-container");
      const stepIndicatorEl = document.getElementById("step-indicator");
      const backBtn = document.getElementById("back-btn");

      function renderStep() {
        const step = steps[currentStep];
        questionTextEl.textContent = step.label;
        optionsContainerEl.innerHTML = "";

        step.options.forEach((option) => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "choice-btn";
          btn.textContent = option.label;
          btn.addEventListener("click", () =>
            handleAnswer(step.key, option.value)
          );
          optionsContainerEl.appendChild(btn);
        });

        stepIndicatorEl.textContent = `Question ${currentStep + 1} / ${
          steps.length
        }`;
        backBtn.style.display = currentStep === 0 ? "none" : "block";
      }

      function handleAnswer(key, value) {
        answers[key] = value;
        currentStep++;
        currentStep < steps.length ? renderStep() : showResult();
      }

      function evaluateEligibility() {
        const issues = [];
        let status = "ok";

        if (answers.status === "locataire_sans_accord") {
          status = "blocked";
          issues.push(
            "Vous êtes locataire sans accord écrit : il est indispensable d’obtenir l’autorisation du propriétaire (et éventuellement du syndic) avant toute installation."
          );
        }

        if (answers.copro === "interdit") {
          status = "blocked";
          issues.push(
            "Votre copropriété interdit les unités extérieures en façade / balcon. Sans dérogation, l’installation d’une PAC air-air n’est pas possible."
          );
        } else if (answers.copro === "a_verifier" && status !== "blocked") {
          status = "conditional";
          issues.push(
            "Les règles de copropriété doivent être vérifiées (règlement ou contact avec le syndic) avant de valider le projet."
          );
        }

        if (answers.outdoorSpace === "aucun") {
          status = "blocked";
          issues.push(
            "Vous n’indiquez aucun emplacement possible pour l’unité extérieure. Une PAC air-air nécessite obligatoirement un emplacement extérieur adapté."
          );
        }

        if (answers.electricPower === "6kva" && status !== "blocked") {
          status = "conditional";
          issues.push(
            "Avec un abonnement de 6 kVA, une vérification de la puissance disponible et de la gestion des autres appareils électriques est recommandée."
          );
        }

        if (answers.electricPanel === "non" && status !== "blocked") {
          status = "conditional";
          issues.push(
            "Votre tableau électrique semble ancien : un électricien devra vérifier la possibilité d’ajouter un circuit dédié et sécurisé."
          );
        }

        if (answers.electricPanel === "inconnu" && status !== "blocked") {
          status = status === "ok" ? "conditional" : status;
          issues.push(
            "L’état du tableau électrique reste à vérifier pour garantir un branchement conforme et sécurisé."
          );
        }

        if (answers.noise === "fortes" && status !== "blocked") {
          status = status === "ok" ? "conditional" : status;
          issues.push(
            "Vous mentionnez des contraintes sonores fortes : le choix de l’emplacement et du modèle devra être étudié avec attention."
          );
        }

        return { status, issues };
      }

      function chooseModel() {
        const rooms = Number(answers.rooms);
        const surface = answers.surface;
        const isolation = answers.isolation;
        const climate = answers.climate;

        if (rooms >= 2) return rooms === 2 ? "SCM 52 DUO" : "SCM 52 MULTI";
        if (surface === "S1") return "SC6026";

        if (surface === "S2") {
          if (
            isolation === "faible" ||
            climate === "froid" ||
            climate === "montagne"
          ) {
            return "SC6053";
          }
          return "SC6035";
        }

        return "SC6053";
      }

      function getModelAsset(model) {
        const assets = {
          SC6026: {
            src: "img/pac/SC6026.png",
            alt: "Pompe à chaleur Qlima SC6026",
          },
          SC6035: {
            src: "img/pac/SC6035.png",
            alt: "Pompe à chaleur Qlima SC6035",
          },
          SC6053: {
            src: "img/pac/SC6053.png",
            alt: "Pompe à chaleur Qlima SC6053",
          },
          "SCM 52 DUO": {
            src: "img/pac/SCM52_DUO.png",
            alt: "Pompe à chaleur Qlima SCM 52 DUO",
          },
          "SCM 52 MULTI": {
            src: "img/pac/SCM52_MULTI.png",
            alt: "Pompe à chaleur Qlima SCM 52 MULTI",
          },
        };
        return assets[model] || null;
      }

      function getModelUrl(model) {
        const urls = {
          SC6026:
            "https://www.qlima.fr/pompe-a-chaleur-air-air-pret-a-poser-sc-6026-blanc.html",
          SC6035:
            "https://www.qlima.fr/pompe-a-chaleur-air-air-pret-a-poser-sc-6035-blanc.html",
          SC6053:
            "https://www.qlima.fr/pompe-a-chaleur-air-air-pret-a-poser-sc-6053-blanc.html",
          "SCM 52 DUO":
            "https://www.qlima.fr/pompe-a-chaleur-duo-1-2-scm-52-duo-blanc.html",
          "SCM 52 MULTI":
            "https://www.qlima.fr/pompe-a-chaleur-multi-air-air-pret-a-poser-1-3-scm-52-multi-2x2-5-1x3-2-blanc.html",
        };
        return urls[model] || null;
      }

      function showResult() {
        const { status, issues } = evaluateEligibility();

        // Cas bloquant
        if (status === "blocked") {
          questionTextEl.textContent =
            "Votre situation nécessite des vérifications avant d’installer une pompe à chaleur air-air";
          const issuesList = issues.map((txt) => `<li>${txt}</li>`).join("");

          optionsContainerEl.innerHTML = `
            <div class="result-text">
              <p>
                D’après vos réponses, une installation de pompe à chaleur air-air n’est pas validée pour le moment.
              </p>
              <ul class="result-list">${issuesList}</ul>
              <p>
                Nous vous conseillons de vérifier ces points (accord propriétaire / syndic, emplacement extérieur, contraintes réglementaires) avant d’aller plus loin.
              </p>
            </div>

            <button type="button" class="choice-btn primary" onclick="restartQuiz()">
              Recommencer le questionnaire
            </button>
          `;

          stepIndicatorEl.textContent = "Conclusion";
          backBtn.style.display = "block";
          currentStep = steps.length;
          return;
        }

        // Recommandation
        const model = chooseModel();
        const asset = getModelAsset(model);
        const productUrl = getModelUrl(model);
        const isMulti = model === "SCM 52 DUO" || model === "SCM 52 MULTI";

        let warningHtml = "";
        if (status === "conditional" && issues.length > 0) {
          const issuesList = issues.map((txt) => `<li>${txt}</li>`).join("");
          warningHtml = `
            <div class="result-warning">
              <p><strong>Points à vérifier avant l’installation :</strong></p>
              <ul class="result-list">${issuesList}</ul>
            </div>
          `;
        }

        const badges = `
          <div class="result-badges">
            <span class="badge">${isMulti ? "Multi-split" : "Mono-split"}</span>
            <span class="badge">${
              isMulti
                ? "Pose au sol obligatoire"
                : "Pose sol ou façade possible"
            }</span>
          </div>
        `;

        questionTextEl.textContent = "Votre recommandation Qlima";

        optionsContainerEl.innerHTML = `
          <div class="result-wrap">

            <div class="result-hero">

              <div class="result-product">
                <img src="${asset?.src || ""}" alt="${
          asset?.alt || ""
        }" loading="lazy" />
                <div class="result-model">
                  <h3>Votre recommandation</h3>

                  <p>
                    Le modèle recommandé pour votre situation est :
                    <strong>${model}</strong>.
                  </p>
                  <p>
                    Cette recommandation est basée sur le type de logement, la surface,
                    l’isolation et le nombre de pièces à équiper.
                  </p>

                  ${badges}

                  <div class="result-cta">
                    <a
                      href="${productUrl}"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="choice-btn choice-link secondary"
                    >
                      Découvrir ce modèle sur Qlima.fr
                    </a>
                  </div>
                </div>
              </div>

              ${warningHtml}
            </div>

            <div class="result-grid">

              <div class="result-card">
                <h4>Accessoires nécessaires (non inclus)</h4>
                <p>
                  L’achat de la PAC ne comprend pas tous les accessoires indispensables à la pose.
                  Selon votre configuration, il faudra prévoir :
                </p>
                <ul class="result-list">
                  <li>Les <strong>liaisons frigorifiques</strong> correspondant à la configuration choisie</li>
                  <li>Les <strong>raccords</strong></li>
                  <li>Les <strong>goulottes</strong></li>
                  <li>Les <strong>silent blocs</strong></li>
                  ${
                    isMulti
                      ? ""
                      : "<li>Les <strong>équerres</strong> (uniquement si pose murale/façade)</li>"
                  }
                </ul>
                <p style="margin-top:10px;">
                  ${
                    isMulti
                      ? "<strong>Important :</strong> pour <strong>SCM 52 DUO</strong> et <strong>SCM 52 MULTI</strong>, la <strong>pose au sol est obligatoire</strong>."
                      : "<strong>Note :</strong> pour les modèles mono-split, la pose au sol ou en façade est possible selon votre situation."
                  }
                </p>
              </div>

              <div class="result-card contact-card">
                <h4>Contact technicien Qlima</h4>
                <p>
                  Pour discuter techniquement de l’installation et organiser la mise en service
                  (pose par techniciens agréés), contactez-nous :
                </p>
                <div class="result-cta">
                  <a class="choice-btn secondary" href="tel:+33232960749">Appeler le 02 32 96 07 49</a>
                  <a
                    class="choice-btn secondary"
                    href="mailto:c.courvalet@pvg.eu?subject=Demande%20d%E2%80%99assistance%20pose%20PAC%20Qlima&body=Bonjour%2C%0A%0AJe viens de r%C3%A9aliser la simulation PAC air-air et j%E2%80%99aimerais %C3%AAtre accompagn%C3%A9(e) pour la pose et/ou la mise en service.%0A%0AMod%C3%A8le recommand%C3%A9%20%3A%20${encodeURIComponent(
                      model
                    )}%0A%0AVille%20%2F%20Code%20postal%20%3A%20%0AType%20de%20logement%20%3A%20%0ANombre%20de%20pi%C3%A8ces%20%C3%A0%20%C3%A9quiper%20%3A%20%0A%0AMerci%2C%0A"
                  >
                    Envoyer un e-mail
                  </a>
                </div>
              </div>

              <div class="result-card" style="grid-column: 1 / -1;">
                <h4>Documents utiles avant la visite du technicien</h4>
                <p>
                  Consultez ces documents pour préparer la pose avant la mise en service par un technicien agréé :
                </p>
                <ul class="docs-list">
                  <li>
                    <a class="doc-link" href="https://www.qlima.com/media/wysiwyg/Pages_de_BAT_CARNET_CASTORAMA_POSE.pdf" target="_blank" rel="noopener noreferrer">
                      Document 1 — Guide de pose
                    </a>
                  </li>
                  <li>
                    <a class="doc-link" href="https://www.qlima.com/media/wysiwyg/Pages_de_BAT_CARNET_CASTORAMA_MISE_EN_SERVICE.pdf" target="_blank" rel="noopener noreferrer">
                      Document 2 — Guide mise en service
                    </a>
                  </li>
                </ul>
              </div>

            </div>

            <!-- ✅ demandé : bouton tout en bas -->
            <button type="button" class="choice-btn primary" onclick="restartQuiz()">
              Recommencer le questionnaire
            </button>

          </div>
        `;

        stepIndicatorEl.textContent = "Simulation terminée";
        backBtn.style.display = "block";
        currentStep = steps.length;
      }

      backBtn.addEventListener("click", () => {
        if (currentStep >= steps.length) {
          currentStep = steps.length - 1;
          renderStep();
        } else if (currentStep > 0) {
          currentStep--;
          renderStep();
        }
      });

      function restartQuiz() {
        currentStep = 0;
        Object.keys(answers).forEach((k) => delete answers[k]);
        renderStep();
      }

      renderStep();
    </script>
  </body>
</html>
